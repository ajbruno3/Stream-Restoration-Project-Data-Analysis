<!DOCTYPE html>
<html><head>
</head><body style="color: #202122;"><p>#R code is just text - I could share a .r file, but d2l would complain about it because it is unfamiliar with the file type. &nbsp;Instead, here is the text. &nbsp;Create a script in R, and past this in.</p>
<p>#generate random dataset w/ suggestive pattern<br>streamData=data.frame(downstreamDistance=seq(from=0,to=500,length.out=10),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; response=(seq(from=6,to=7,length.out=10))-runif(10)*2,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; category=c(rep("A",5),rep("B",5))<br>)<br>#this is a randomly generated dataset. &nbsp;To analyze your real data, read it in using read.csv or similar.&nbsp; RStudio has an interactive 'import dataset' tool that can help</p>
<p><br>#plot of response~category<br>boxplot(streamData$response~streamData$category)</p>
<p><br>#plot of response~distance<br>plot(streamData$response~streamData$downstreamDistance)</p>
<p>#fit a linear model using lm(), and the same formula used to make the plot. &nbsp;Save the lm as 'fit'<br>fit=lm(streamData$response~streamData$downstreamDistance)</p>
<p>#add the fitted line to the plot using the lm object 'fit'<br>abline(fit)</p>
<p># For this example, suppose that we predict a positive correlation between response and distance.<br>#what is the slope of the line?<br>#str shows the structure of the 'fit' object:<br>str(fit)</p>
<p>#in this object, there are coefficients:<br>fit$coefficients</p>
<p>#The second is the slope:<br>fit$coefficients[2]</p>
<p><br>#how to randomize the response data using sample()<br>?sample<br>#the first argument to sample() is what set of values to sample from</p>
<p>#'size' is an optional second argument that determines how many samples are drawn<br>#If we don't supply a 'size' argument, than the default behavior of sample() is to return&nbsp;<br>#the same number of samples as are in the given set of values</p>
<p>#replace parameter determines how the sample is drawn - &nbsp;with or without replacement<br>sample(c(1,2,3,4),replace=F)<br>sample(c(1,2,3,4),replace=T)<br>#we usually want replace=T for this bootstrapping approach</p>
<p>#sample of the response data<br>sample(streamData$response,replace=T)</p>
<p><br>#function for resampling and fitting the data<br>#this function needs only one input, the dataframe that will be resampled and fitted.<br>#the function will resample the data, fit a lm, and then return the coefficient.<br>#This function is not actually run here, it is just defined. &nbsp;It is run with replicate() below.<br>#It is best for the dataframe to have a different name inside the dataframe than it does elsewhere<br>#we define this name in the () in the function definition:<br>resampleAndFit=function(thisStreamData){<br>&nbsp; #within the function, streamData does not exist, but thisStreamData does<br>&nbsp;&nbsp;<br>&nbsp; #resample the response variable with replace = true<br>&nbsp; resampledResponse=sample(thisStreamData$response,replace=T)<br>&nbsp;&nbsp;<br>&nbsp; #fit a lm to the resampled dataset, save it as resampleFit<br>&nbsp; resampleFit=lm(resampledResponse~thisStreamData$downstreamDistance)<br>&nbsp;&nbsp;<br>&nbsp; #points or fitted lines representing the resampled data can be added to the plot by uncommenting out these lines:<br>&nbsp; #points(resampledResponse~thisStreamData$downstreamDistance,pch=2)<br>&nbsp; #abline(resampleFit)<br>&nbsp;&nbsp;<br>&nbsp; #return the slope coefficient<br>&nbsp; return(resampleFit$coefficients[[2]])<br>}</p>
<p>#run the command 'resampleAndFit(streamData)' 1000 times, and save the output as resampledSlopes<br>resampledSlopes=replicate(1000,resampleAndFit(streamData))<br>#is 1000 enough? &nbsp;test by running a few times and seeing if the p value changes</p>
<p>#take a look at the distribution of the resampled slopes:<br>hist(resampledSlopes)</p>
<p>#remember that in all the resampled data, there is no meaningful relationship between the x and y variables.<br>#therefore, the mean of the resampledSlopes should be close to 0. &nbsp;If it's not, something is wrong<br>mean(resampledSlopes)</p>
<p><br>#A p value as the probability that a pattern (e.g., slope) equivalent to&nbsp;<br># or more extreme than the observed pattern would occur if in fact there was no meaningful relationship.</p>
<p><br># In this example, we are predicting a positive correlation (a positive slope).<br># Therefore, we want to ask what proportion of the population of slopes fitted to the<br># randomly resampled dataset are GREATER THAN the observed slope in the actual data<br># the '&gt;' operator asks weather resampledSlopes is greater than the actual fitted coefficient<br># this returns a set of TRUE or FALSE values:<br># TRUE where the resampled slope is greater than the slope of the actual data,<br># and FALSE where the resampled slope is less than the slope of the actual data,<br># R can also think of TRUE and FALSE as 1 and 0, thus the mean of the T/F set is the proportion of TRUEs</p>
<p>#therefore, this value is the p value:<br>mean(resampledSlopes&gt;fit$coefficients[2])</p></body></html>